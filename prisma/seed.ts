import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

type ThemeSeed = {
  worldviewCardId: string
  title: string
  description: string
  imageUrl: string
  questions: string[]
}

const MOONSHOT_THEMES: ThemeSeed[] = [
  {
    worldviewCardId: 'goal1',
    title: 'ムーンショット目標1: 身体・脳・空間・時間の制約からの解放',
    description:
      '2050年までに、人が身体、脳、空間、時間の制約から解放された社会を目指します。アバター、遠隔存在、認知拡張などを通じて、人の可能性を広げる設計を考えるテーマです。',
    imageUrl:
      'https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&w=1600&q=60',
    questions: [
      '授業に分身で参加できるなら、対面の出席と同じ評価にしてよい。',
      '分身参加が広がるなら、登校している生徒の活動量が減っても受け入れるべきだ。',
      '身体を助ける技術は、高額でも希望者が使えるよう公費で支えるべきだ。',
      '公平性を守るため、能力を強く高める技術は利用を制限すべきだ。',
      '分身での発言は、本人の発言と同じ重みで扱うべきだ。',
      '本人確認の厳しさで参加しにくくなるなら、多少の不正リスクは受け入れるべきだ。',
      '移動の制約が減るなら、学校行事は現地参加中心でなくてもよい。',
      '対面でしか得られない経験を守るため、分身利用の上限を設けるべきだ。',
      '技術で参加者が増えるなら、授業進行が複雑になっても導入を進めるべきだ。',
      '選択の自由を守るため、分身を使わない権利を制度として明記すべきだ。',
      '遠隔操作の分身でも体育や実験に参加できる仕組みを整えるべきだ。',
      '身体を使う学びは対面でしかできないため、分身での代替には限界がある。',
      '分身を使った学習記録は、本人の成長を示す資料として進路に活用してよい。',
      '学習記録の使い方が広がりすぎないよう、利用目的を本人が管理できるべきだ。',
      '技術に慣れていない教員にも使えるよう、学校が十分な研修を用意すべきだ。',
      '教員の負担を考えると、分身対応は希望する教員だけにすべきだ。',
      '災害や感染症のとき、分身での授業参加を標準の手段として認めるべきだ。',
      '緊急時でも対面の再開を最優先にし、分身は一時的な手段にとどめるべきだ。',
      '分身技術に長く頼ると対面の力が弱くなるため、利用期間に区切りを設けるべきだ。',
      '本人が必要とする限り利用を続けられるよう、期間の制限は設けないべきだ。',
    ],
  },
  {
    worldviewCardId: 'goal2',
    title: 'ムーンショット目標2: 超早期予測・予防医療',
    description:
      '2050年までに、超早期に疾患の予測予防ができる社会を目指します。予測精度だけでなく、倫理、説明責任、データガバナンスを含めて議論するテーマです。',
    imageUrl:
      'https://images.unsplash.com/photo-1579684385127-1ef15d508118?auto=format&fit=crop&w=1600&q=60',
    questions: [
      '病気を早く見つけるためなら、日常データの収集範囲が広がってもよい。',
      'プライバシーを守るため、予測精度が下がっても取得データは最小限にすべきだ。',
      '高リスク判定が出た人には、本人希望がなくても早期受診を強く促すべきだ。',
      '不安を増やさないため、確信度が低い判定は本人に通知しないほうがよい。',
      '保険料の公平性のため、予測リスクを保険設計に一部反映してよい。',
      '差別を防ぐため、予測リスクは保険・進学・就職に一切使うべきではない。',
      '家庭の健康管理を助けるため、家族間でのリスク共有を標準にしてよい。',
      '本人の自己決定を守るため、家族であっても同意なし共有は認めないべきだ。',
      '予測が外れても全体利益が大きいなら、導入を続けるべきだ。',
      '個人の不利益が一定数出るなら、全体利益があっても見直すべきだ。',
      '子どものデータも早期から集めたほうが、将来の病気予防に役立つ。',
      '子どもの健康データは本人が大人になってから使い方を決められるべきだ。',
      '学校の健康診断にAI予測を加えれば、見落としを減らせる。',
      '健康診断での過剰な予測は、生徒に不要な心配を与えるため慎重にすべきだ。',
      '心の不調も予測できるなら、身体と同じように早期発見の対象にすべきだ。',
      '心の状態は変わりやすいため、数値で予測して対応するのは危険が大きい。',
      '自分の健康データは本人がいつでも見られるようにすべきだ。',
      '専門家の説明なしにデータだけ見ると誤解が生まれるため、閲覧には条件をつけるべきだ。',
      '予防にお金をかければ将来の医療費を減らせるので、積極的に投資すべきだ。',
      '効果が不確実な予防より、今困っている人への治療を優先すべきだ。',
    ],
  },
  {
    worldviewCardId: 'goal3',
    title: 'ムーンショット目標3: AIとロボットの共進化',
    description:
      '2050年までに、AIとロボットの共進化により、自ら学習行動し人と共生するロボットの実現を目指します。協働、安全、責任分界を具体化するテーマです。',
    imageUrl:
      'https://images.unsplash.com/photo-1581092335878-8d9ff86ca2bf?auto=format&fit=crop&w=1600&q=60',
    questions: [
      '授業効率が上がるなら、一部の学習支援をロボット主導にしてよい。',
      '学習の納得を守るため、支援は遅くなっても人が最終説明すべきだ。',
      '危険回避のためなら、ロボットが人の指示を一時的に無視してよい。',
      '責任を明確にするため、ロボットは常に人の指示に従うべきだ。',
      '安全性が高いなら、教員数不足を補う目的でロボット活用を進めるべきだ。',
      '人間関係の学びを守るため、教員の代替につながる活用は抑えるべきだ。',
      '見守り精度が上がるなら、校内の行動データ取得を増やしてよい。',
      '監視感を減らすため、見守り精度が下がっても取得データを減らすべきだ。',
      '故人AIは遺族の支えになるなら、期間限定で利用を認めてよい。',
      '故人AIは悲嘆を長引かせる恐れがあるため、原則として慎重に制限すべきだ。',
      'ロボットが出した判断の理由は、利用者にわかる形で必ず示すべきだ。',
      '説明に時間がかかるなら、安全が確保される範囲で説明を省略してよい。',
      'ロボットの動作で事故が起きた場合、製造者が責任を負うべきだ。',
      '利用者の使い方にも原因があるなら、責任は利用者と分け合うべきだ。',
      'ロボットとの交流で生まれる親しみは、人間関係の練習として認めてよい。',
      '人との関係を弱めないよう、ロボットへの感情的な依存は避けるべきだ。',
      'AIが生徒の理解度に合わせて出題を変えれば、テストはより公平になる。',
      '出題が人によって違うと比較ができないため、テストの条件は統一すべきだ。',
      'ロボットの導入費用は将来の人件費削減で回収できるため、投資すべきだ。',
      '費用を理由にロボットを入れると、人の雇用が失われるため慎重にすべきだ。',
    ],
  },
  {
    worldviewCardId: 'goal7',
    title: 'ムーンショット目標7: 100歳まで健康不安なく生きる社会',
    description:
      '2040年までに、主要な疾患を予防・克服し、100歳まで健康不安なく人生を楽しめるサステイナブルな医療・介護システムを目指します。',
    imageUrl:
      'https://images.unsplash.com/photo-1512678080530-7760d81faba6?auto=format&fit=crop&w=1600&q=60',
    questions: [
      '限られた予算なら、治療より予防に多く配分すべきだ。',
      '重い病気の救命を優先するため、予防への配分は抑えるべきだ。',
      '介護人材不足への対応として、機械活用を広く進めるべきだ。',
      '利用者の安心感を守るため、機械導入は限定的にすべきだ。',
      '地域差を減らすため、サービス水準を国の基準で統一すべきだ。',
      '地域の実情に合わせるため、サービス設計は自治体裁量を広く認めるべきだ。',
      '家族負担を減らすため、在宅ケアより施設ケアを拡充すべきだ。',
      '本人の生活継続を重視して、在宅ケア中心の体制を優先すべきだ。',
      '公平性のため、年齢に応じて医療優先順位を一定程度考慮してよい。',
      '人の価値を年齢で分けないため、優先順位に年齢を使うべきではない。',
      '心の健康も身体と同じように、定期検診の対象に加えるべきだ。',
      '心の状態を定期的に調べると、かえって不安を生むため任意にすべきだ。',
      '運動習慣を増やす政策には、公費を使ってでも取り組むべきだ。',
      '運動するかどうかは個人の自由であり、政策で促すのは行き過ぎだ。',
      '高齢者が働き続けられる環境を整えることは、社会全体の利益になる。',
      '高齢者に働くことを期待しすぎると、休む権利が軽くなる恐れがある。',
      '健康に関する正しい知識を学校教育で必修にすべきだ。',
      '健康の学び方は家庭ごとに異なるため、学校で一律に教えるのは難しい。',
      '一人暮らしの高齢者を地域で見守る仕組みは、全国で整えるべきだ。',
      '見守りが行き過ぎると本人の自由を奪うため、希望者だけにすべきだ。',
    ],
  },
]

async function upsertThemeWithQuestions(seed: ThemeSeed) {
  const existing = await prisma.theme.findFirst({
    where: { title: seed.title },
    select: { id: true },
  })

  const theme = existing
    ? await prisma.theme.update({
      where: { id: existing.id },
      data: {
        worldviewCardId: seed.worldviewCardId,
        description: seed.description,
        imageUrl: seed.imageUrl,
        status: 'ACTIVE',
      },
    })
    : await prisma.theme.create({
      data: {
        worldviewCardId: seed.worldviewCardId,
        title: seed.title,
        description: seed.description,
        imageUrl: seed.imageUrl,
        status: 'ACTIVE',
      },
    })

  await prisma.question.deleteMany({
    where: { themeId: theme.id },
  })

  await prisma.question.createMany({
    data: seed.questions.map((questionText, index) => ({
      themeId: theme.id,
      questionText,
      order: index + 1,
      questionType: 'YES_NO_UNKNOWN',
    })),
  })

  return theme.id
}

async function main() {
  const ids: string[] = []
  for (const seed of MOONSHOT_THEMES) {
    const id = await upsertThemeWithQuestions(seed)
    ids.push(id)
  }

  console.log('Seed completed:', {
    themeCount: ids.length,
    themeIds: ids,
  })
}

main()
  .catch((error) => {
    console.error(error)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })
