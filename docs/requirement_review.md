# `docs/requirement.md` レビュー結果（改訂版）

## レビュー方針
- 対象: `docs/requirement.md`
- 観点: 実装可能性 / 運用安全性 / 教育現場での説明責任
- 目的: 「何を直せば実装に入れるか」を明確にする

## 総評
- 体験導線（診断→テーマ→回答→可視化）と、Phase分割は明確で、MVP設計としては良い土台です。
- ただし現時点では、**セキュリティ・データガバナンス・可視化解釈責任**の3点で仕様の空白があり、実装着手後に手戻りが起きやすい状態です。

---

## 良い点（維持推奨）
1. **学習体験の流れが明確**
   - Big Fiveから意見マップまでの導線が一貫しており、UI要件と機能要件のズレが少ないです。
2. **段階導入計画が現実的**
   - 高リスク要素（可視化/リアルタイム）を後段に配置しているため、初期品質を担保しやすいです。
3. **アクセシビリティの方向性が明確**
   - WCAG、キーボード操作、スクリーンリーダー、非色情報依存など重要要件が揃っています。

---

## 指摘事項（優先度つき）

### P0（実装前に確定必須）

#### 1) 教育データの取り扱いルール不足
**懸念**
- 「学生はセッションIDのみで匿名参加」とあるものの、授業環境では実運用上ほぼ再識別可能です。

**不足している要件**
- データ分類（個人情報 / 準個人情報 / 統計情報）
- 保持期間・削除方針（回答、ログ、バックアップ）
- 同意取得・説明責任・監査証跡の要件

**修正案（要件に追加する文章例）**
- 「学生回答データは準個人情報として扱い、セッション終了後90日で自動削除する。監査ログは180日保持する。」

#### 2) 認証/認可の実運用要件不足
**懸念**
- 管理者認証（セッションID + パスコード + JWT）の記述のみでは、漏えい時の被害抑止が弱いです。

**不足している要件**
- 試行回数制限・ロックアウト
- JWT有効期限・失効戦略（再発行/強制ログアウト）
- 管理者操作の監査ログ（閲覧/エクスポート/設定変更）

**修正案**
- 「管理者ログイン失敗5回で15分ロック。JWT有効期限は15分、リフレッシュは8時間。」

#### 3) 可視化結果（UMAP/K-means）の解釈責任が未定義
**懸念**
- 対立/合意の表示は、学習者ラベリングや誤った評価につながる可能性があります。

**不足している要件**
- 探索的可視化である旨の明示
- 教員向け解釈ガイドライン
- 再計算変動や不確実性の説明

**修正案**
- 可視化画面に固定注記を追加: 「本結果は統計的傾向であり、個人評価を目的としません。」

### P1（Phase 1〜2で決定推奨）

#### 4) パフォーマンス要件の測定条件不足
**懸念**
- 目標値はあるが、端末/回線/同時接続条件がないため合否判定が不可能です。

**不足している要件**
- 測定端末（例: 学校配布Chromebookクラス）
- ネットワーク条件（Wi-Fi帯域、同時接続数）
- 評価統計（P50/P95/P99）

#### 5) SSE障害時の振る舞い未定義
**懸念**
- 再接続ポリシーがないと授業中の監視画面で欠損が起こります。

**不足している要件**
- 再接続間隔・上限
- `Last-Event-ID` を用いた再開
- 切断時のUI表示（再接続中バナーなど）

#### 6) 単一セッション前提と将来拡張の境界が曖昧
**懸念**
- `School` がFuture Work扱いなのにデータモデルに存在し、実装責務が曖昧です。

**推奨判断**
- 今期は単一学校前提で固定するのか
- 将来互換のためテナントID列だけ先行導入するのか

### P2（早めの改善推奨）

#### 7) 関連ドキュメント参照がローカル絶対パス
**懸念**
- `c:\Users\...` はチーム共有不可で、トレーサビリティが落ちます。

**修正案**
- リポジトリ相対パスまたは社内Wiki URLに置換

---

## 受け入れ基準（そのまま転記できる形式）
- 主要APIは正常系/異常系/認証失敗のレスポンス仕様（HTTP code + JSON schema）を定義済み。
- 可視化画面に「解釈上の注意」文言が常時表示される。
- 50/100/150人での処理時間SLO（P95）を定義し、計測手順を文書化する。
- 障害時Runbook（問い合わせ窓口、ログ採取手順、一次切り分け）を整備する。

## 最短での修正順（提案）
1. P0の3項目を要件本文に追記（データ/認証/解釈責任）
2. P1の2項目を非機能要件に追記（性能測定条件/SSE復旧）
3. 関連ドキュメント参照を相対パス化

## 結論
- 現行要件は「構想としては強い」が「運用仕様が薄い」状態です。
- まずP0を確定すれば、設計・実装フェーズでの手戻りを大幅に減らせます。
